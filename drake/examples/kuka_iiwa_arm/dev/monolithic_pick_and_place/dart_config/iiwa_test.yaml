# From:
# manipulation_tracking:d54a3c5:config/estimator_config_irb140_gelsight.yaml (master)

# Root is drake::GetDrakePath()

robots:
  camera:
    urdf: "/examples/kuka_iiwa_arm/models/objects/xtion.urdf"
    q0: 
      base_x: 0
      base_y: 2
      base_z: 2
      base_roll: 0.0
      base_pitch: 0.349065850399
      base_yaw: -1.57079632679
  iiwa:
    urdf_less_collision: "/manipulation/models/iiwa_description/urdf/iiwa14_polytope_collision.urdf"
    urdf: "/manipulation/models/iiwa_description/urdf/iiwa14_mesh_decimated_collison.urdf"
    q0: 
      base_x: 0
      base_y: 0
      base_z: 0.7645
  wsg:
    # Do not use full model given that it has loop joints
    urdf: "/manipulation/models/wsg_50_description/sdf/schunk_wsg_50_estimation.sdf"
    weld_to_frame: iiwa_frame_ee
  # # table:
  # #   urdf_less_collision: "/examples/kuka_iiwa_arm/models/table/extra_heavy_duty_table_surface_only_collision.sdf"
  # #   urdf: "/examples/kuka_iiwa_arm/models/table/extra_heavy_duty_table.sdf"
  # #   q0: 
  # #     base_x: 0.243716
  # #     base_y: 0.625087
  # #     base_z: 0.
  # table_final: # Pos. C
  #   urdf_less_collision: "/examples/kuka_iiwa_arm/models/table/extra_heavy_duty_table_surface_only_collision.sdf"
  #   urdf: "/examples/kuka_iiwa_arm/models/table/extra_heavy_duty_table.sdf"
  #   q0:
  #     base_x: 1.143716
  #     base_y: 0.265087
  #     base_z: -0.07
  target:
    urdf: "/examples/kuka_iiwa_arm/models/objects/block_for_pick_and_place.urdf"
    q0:
      base_x: 0.8
      base_y: 0.36
      base_z: 1.05 # 1.1345
# Posts (except for Pos. C)
  # yellow_post_1:
  #   urdf: "/examples/kuka_iiwa_arm/models/objects/yellow_post.urdf"
  #   q0: 
  #     base_x: 0.00
  #     base_y: 1.00
  #     base_z: 0

  yellow_post_2:
    urdf: "/examples/kuka_iiwa_arm/models/objects/yellow_post.urdf"
    q0: 
      base_x: 0.80
      base_y: 0.36
      base_z: 0

  # yellow_post_3:
  #   urdf: "/examples/kuka_iiwa_arm/models/objects/yellow_post.urdf"
  #   q0: 
  #     base_x: 0.30
  #     base_y: -0.9
  #     base_z: 0
  # yellow_post_4:
  #   urdf: "/examples/kuka_iiwa_arm/models/objects/yellow_post.urdf"
  #   q0: 
  #     base_x: -0.1
  #     base_y: -1.0
  #     base_z: 0
  # yellow_post_5:
  #   urdf: "/examples/kuka_iiwa_arm/models/objects/yellow_post.urdf"
  #   q0: 
  #     base_x: -0.47
  #     base_y: -0.8
  #     base_z: 0

# force_align:
#   # force alignment of these frames in the estimator every iteration
#   source_robot: "iiwa"
#   dest_frame: "robot_base"

publish_all: true

joints_tracked:
  target: ['base_x', 'base_y', 'base_z', 'base_yaw']  # 'base_roll', 'base_pitch', 
  # yellow_post_2: ['base_x', 'base_y', 'base_z', 'base_roll', 'base_pitch', 'base_yaw']

dynamics:
  dynamics_floating_base_var: 0.0001 # m per frame
  dynamics_other_var: 0.0001 # rad per frame
  verbose: True
  # and robot-specific additional gains:
  robot_specific_vars:
    - robot: "iiwa"
      dynamics_floating_base_var: 0.00000001 # m per frame
      dynamics_other_var: 0.01 # rad per frame
    - robot: "camera"
      dynamics_floating_base_var: 0.000000001
      dynamics_other_var: 0.000000001
    - robot: "target"
      dynamics_floating_base_var: 0.000001
      dynamics_other_var: 0.000001

costs:
  - type: "NonpenetratingObjectCost"
    nonpenetration_var: 1 # m
    min_considered_penetration_distance: 0.001
    verbose: True
    verbose_lcmgl: True
    num_surface_pts: 200
    nonpenetrating_robot: "target"
    penetrable_robots: ["table", "camera"]

  - type: "KinectFrameCost"
    icp_var: 0.01 # m
    free_space_var: .inf # 1 # 0.5
    max_considered_icp_distance: 0.1
    min_considered_joint_distance: 0.00
    verbose: True
    verbose_lcmgl: True
    downsample_amount: 5.0
    #camera_body: "camera"
    world_frame: True
    bounds:
      xMin: -2
      xMax: 2
      yMin: -2
      yMax: 2
      zMin: -2
      zMax: 2

  # - type: "RobotStateCost"
  #   joint_known_fb_var: 0.01 # m
  #   joint_known_encoder_var: 0.01 # radian
  #   transcribe_floating_base_vars: False
  #   verbose: False
  #   # state_channelname: "EST_ROBOT_STATE"
